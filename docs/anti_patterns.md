# Anti-Patterns: Insurance CRM 프로젝트

> 이 프로젝트에서 발생한 실패 패턴 기록

---

## 프로젝트별 Anti-Patterns

| ID | 패턴 | 증상 | 해결책 | 발생일 |
|---|------|------|--------|--------|
| CRM-001 | SELECT * 컬럼 순서 불일치 | 고객 데이터 뒤섞임 (주민번호가 운전 칸에 표시) | `SELECT *` 대신 명시적 컬럼 목록 사용 | 2026-02-14 |
| CRM-002 | 인디케이터 set 덮어쓰기 | 아이콘이 전혀 표시 안 됨 | set을 한 번만 계산하고 재할당 금지 | 2026-02-14 |
| CRM-003 | 고객/계약 결제방식 불일치 | 계좌이체 고객에 카드 아이콘 표시 | 더미 데이터에서 고객/계약 결제방식 일치시킴 | 2026-02-14 |

---

### CRM-001: SELECT * 컬럼 순서 불일치 (심각)

**증상**: 고객 테이블에서 주민번호가 운전 칸에, created_at이 직업 칸에 표시됨
**원인**: SQLite에서 `ALTER TABLE ADD COLUMN`으로 추가된 컬럼은 테이블 **끝**에 배치됨. `SELECT *`는 물리적 순서대로 반환하므로 `from_db_row()`의 위치 기반 파싱과 불일치.
**해결**: `database.py`에 `CUSTOMER_COLUMNS`, `POLICY_COLUMNS` 상수 정의 → 모든 SELECT에서 사용
**교훈**: **SQLite에서 SELECT *는 절대 사용하지 않는다.** 컬럼 추가 시 물리 순서가 바뀔 수 있다.

### CRM-002: 인디케이터 set 덮어쓰기

**증상**: 납부/연체 아이콘이 "all" 필터에서 표시되지 않음
**원인**: `load_customers()` 내에서 아이콘용 set을 먼저 계산한 뒤, 필터 분기 코드에서 동일 변수명으로 빈 set을 재할당
**해결**: 중복 할당 코드 블록 제거 (main_window.py 구 801-812행)
**교훈**: 변수 재할당 시 기존 값이 사라지는지 확인

### CRM-003: 고객/계약 결제방식 불일치

**증상**: 고객의 입금방식이 "계좌이체"인데 💰⚠️ 아이콘 표시
**원인**: 더미 데이터에서 `customer.payment_method`(고객 레벨)과 `policy.payment_method`(계약 레벨)가 독립적으로 랜덤 배정됨
**해결**: 더미 데이터 생성 시 `고객 입금방식 → 계약 결제방식` 매핑 테이블 사용
**교훈**: 고객 레벨과 계약 레벨의 결제방식은 **일관성** 유지 필요

---

## 전역 Anti-Patterns 적용

### AP-004: 한글 인코딩 불일치
- **적용 위치**: database.py
- **조치**: `PRAGMA encoding = 'UTF-8'`

### AP-007: 파일 잠금 충돌
- **적용 위치**: database.py
- **조치**: DB 연결 1개만 유지, 종료 시 close()

### AP-008: PyInstaller DLL 누락
- **적용 위치**: build_exe.bat
- **조치**: `--hidden-import=tkinter,sqlite3,dateutil`

---

*Anti-Patterns는 실패에서 배우는 시스템입니다.*
